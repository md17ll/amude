<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ§Øª Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø© ÙÙŠ Ø¹Ø§Ù…ÙˆØ¯Ø§</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
  margin:0;
  font-family:Tahoma,Arial;
  background:#f4fdf8;
}
header{
  background:#1fa36a;
  color:#fff;
  text-align:center;
  padding:18px;
  font-size:22px;
  font-weight:bold;
}
.container{padding:15px}
.search input{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:1px solid #ccc;
}
.filters{
  display:flex;
  gap:10px;
  margin:15px 0;
}
.filters button{
  flex:1;
  padding:10px;
  border:none;
  border-radius:10px;
  color:#fff;
  font-weight:bold;
}
.open{background:#1fa36a}
.closed{background:#e74c3c}
.all{background:#555}

.card{
  background:#fff;
  border-radius:14px;
  padding:15px;
  margin-bottom:12px;
  box-shadow:0 4px 10px rgba(0,0,0,.1);
}
.card h3{margin:0 0 6px}
.ok{color:#1fa36a;font-weight:bold}
.no{color:#e74c3c;font-weight:bold}

.lock{
  position:fixed;
  bottom:15px;
  left:15px;
  width:44px;
  height:44px;
  border-radius:50%;
  background:rgba(0,0,0,.15);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:22px;
  cursor:pointer;
}

.overlay{
  position:fixed;
  inset:0;
  background:rgba(255,255,255,.95);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
}
.overlay-box{
  background:#fff;
  padding:25px;
  border-radius:14px;
  box-shadow:0 4px 15px rgba(0,0,0,.2);
  text-align:center;
  font-size:18px;
}

.admin{display:none;padding:15px}
.admin input{
  width:100%;
  padding:10px;
  margin-bottom:8px;
}
.admin button{
  width:100%;
  padding:10px;
  background:#1fa36a;
  border:none;
  color:#fff;
  border-radius:8px;
  font-weight:bold;
}
</style>
</head>

<body>

<div class="overlay" id="loading">
  <div class="overlay-box">
    ğŸ’Š Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ§Øª...<br>ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
  </div>
</div>

<header>Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ§Øª Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø© ÙÙŠ Ø¹Ø§Ù…ÙˆØ¯Ø§</header>

<div class="container" id="publicUI">
  <div class="search">
    <input id="search" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† ØµÙŠØ¯Ù„ÙŠØ© Ø¨Ø§Ù„Ø§Ø³Ù…">
  </div>

  <div class="filters">
    <button class="open" onclick="setFilter('open')">Ù…ÙØªÙˆØ­Ø© Ø§Ù„Ø¢Ù†</button>
    <button class="closed" onclick="setFilter('closed')">Ù…ØºÙ„Ù‚Ø© Ø§Ù„Ø¢Ù†</button>
    <button class="all" onclick="setFilter('all')">Ø§Ù„ÙƒÙ„</button>
  </div>

  <div id="list"></div>
</div>

<div class="admin" id="adminUI">
  <h3>Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†</h3>
  <input id="pname" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©">
  <input id="paddress" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†">
  <input id="pphone" placeholder="Ø§Ù„Ù‡Ø§ØªÙ">
  <input id="open" placeholder="ÙˆÙ‚Øª Ø§Ù„ÙØªØ­ 10:00">
  <input id="openampm" placeholder="AM / PM">
  <input id="close" placeholder="ÙˆÙ‚Øª Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ 03:00">
  <input id="closeampm" placeholder="AM / PM">
  <button onclick="add()">Ø¥Ø¶Ø§ÙØ©</button>
</div>

<div class="lock" onclick="login()">ğŸ”’</div>

<script>
const supabase = window.supabase.createClient(
  "https://wvezqetliqbotmkybezj.supabase.co",
  "sb_publishable_APdaO2PyWThd6ISkSdpR1Q_yfTNJO8y"
);

let data=[],filter="open";

function toMin(t,a){
  let [h,m]=t.split(":").map(Number);
  if(a==="PM" && h!==12)h+=12;
  if(a==="AM" && h===12)h=0;
  return h*60+m;
}

function isOpen(p){
  const n=new Date(),now=n.getHours()*60+n.getMinutes();
  const o=toMin(p.open,p.open_ampm);
  const c=toMin(p.close,p.close_ampm);
  return c<o ? now>=o||now<=c : now>=o&&now<=c;
}

function render(){
  const q=search.value.toLowerCase();
  list.innerHTML="";
  data.forEach(p=>{
    const o=isOpen(p);
    if(filter==="open"&&!o)return;
    if(filter==="closed"&&o)return;
    if(!p.pharmacy.toLowerCase().includes(q))return;
    list.innerHTML+=`
      <div class="card">
        <h3>${p.pharmacy}</h3>
        <div>${p.address}</div>
        <div>${p.phone}</div>
        <div class="${o?'ok':'no'}">${o?'Ù…ÙØªÙˆØ­Ø© Ø§Ù„Ø¢Ù†':'Ù…ØºÙ„Ù‚Ø© Ø§Ù„Ø¢Ù†'}</div>
      </div>`;
  });
}

function setFilter(f){filter=f;render()}

async function load(){
  try{
    const r=await supabase.from("pharmacies").select("*");
    data=r.data||[];
  }catch(e){data=[]}
  document.getElementById("loading").style.display="none";
  render();
}

function login(){
  const u=prompt("Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…");
  const p=prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±");
  if(u==="amuda.br"&&p==="@Bb300300"){
    publicUI.style.display="none";
    adminUI.style.display="block";
  }else alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø©");
}

async function add(){
  await supabase.from("pharmacies").insert([{
    pharmacy:pname.value,
    address:paddress.value,
    phone:pphone.value,
    open:open.value,
    open_ampm:openampm.value,
    close:close.value,
    close_ampm:closeampm.value
  }]);
  alert("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©");
  load();
}

search.oninput=render;
load();
</script>

</body>
</html>
