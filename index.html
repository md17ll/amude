<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ§Øª Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø© ÙÙŠ Ø¹Ø§Ù…ÙˆØ¯Ø§</title>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.19.3/dist/xlsx.full.min.js"></script>

<style>
:root{
  --green:#1f9d6a;
  --green-dark:#167a52;
  --bg:#f3faf6;
  --card:#ffffff;
  --text:#1f2937;
  --muted:#6b7280;
  --line:#d1fae5;
  --danger:#b42318;
  --shadow:0 10px 26px rgba(0,0,0,.08);
}
*{box-sizing:border-box;font-family:system-ui}
body{margin:0;background:var(--bg)}
.hidden{display:none!important}

/* Loading */
#loading{
  position:fixed;inset:0;
  background:linear-gradient(135deg,var(--green),var(--green-dark));
  color:#fff;
  display:flex;align-items:center;justify-content:center;
  flex-direction:column;z-index:9999
}
#loading .pill{font-size:46px}

/* Public */
#publicWrapper{max-width:760px;margin:auto;padding:24px 16px 110px}
.main-title{text-align:center;font-size:28px;color:var(--green-dark);font-weight:900}
.search input{width:100%;padding:14px;border-radius:14px;border:1px solid var(--line)}
.filters{display:flex;gap:10px;margin-top:14px}
.filters button{
  flex:1;padding:10px;border-radius:12px;
  border:1px solid var(--line);background:#fff;
  cursor:pointer;transition:.25s
}
.filters button.active{
  background:var(--green);color:#fff;font-weight:900
}
.card{
  background:#fff;border-radius:18px;padding:16px;
  margin-bottom:14px;box-shadow:var(--shadow)
}
.card-top{display:flex;justify-content:space-between}
.badge{padding:6px 14px;border-radius:999px;font-size:13px;font-weight:900}
.open{background:#e6f7ef;color:var(--green-dark)}
.closed{background:#fdeaea;color:var(--danger)}
.meta{font-size:14px;color:var(--muted)}
.empty{text-align:center;color:var(--muted);padding:20px}

/* Lock */
#lockBtn{
  position:fixed;bottom:18px;left:18px;
  background:transparent;border:0;font-size:22px;
  cursor:pointer;opacity:.35
}
#lockBtn:hover{opacity:.8}

/* Modal */
.modal{
  position:fixed;inset:0;
  background:rgba(0,0,0,.45);
  display:flex;align-items:center;justify-content:center;
  z-index:10000
}
.box{
  background:#fff;border-radius:18px;
  width:95%;max-width:1100px;
  box-shadow:0 16px 40px rgba(0,0,0,.25)
}
.boxHeader{
  padding:14px 16px;
  background:linear-gradient(135deg,var(--green),var(--green-dark));
  color:#fff;display:flex;justify-content:space-between
}
.hBtns button{
  background:transparent;border:0;color:#fff;
  cursor:pointer;font-size:13px;opacity:.8
}
.hBtns button:hover{opacity:1}
.boxBody{padding:16px}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}

.panel{
  background:#fff;border:1px solid var(--line);
  border-radius:16px;padding:14px
}
.panel h3{margin:0 0 10px;color:var(--green-dark)}

input,select{
  width:100%;padding:10px;border-radius:12px;
  border:1px solid var(--line);margin-bottom:8px
}
.btn{
  padding:10px;border-radius:12px;
  border:1px solid var(--line);cursor:pointer
}
.btn.primary{background:var(--green);color:#fff;font-weight:900}
.btn.danger{color:var(--danger)}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid var(--line);padding:8px;text-align:center;font-size:13px}
th{background:#eafaf2}
</style>
</head>

<body>

<div id="loading">
  <div class="pill">ğŸ’Š</div>
  <div>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ§Øª...</div>
</div>

<div id="publicWrapper">
  <h1 class="main-title">Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ§Øª Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø© ÙÙŠ Ø¹Ø§Ù…ÙˆØ¯Ø§</h1>
  <div class="search"><input id="searchInput" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† ØµÙŠØ¯Ù„ÙŠØ©"></div>
  <div class="filters" id="filters">
    <button class="active" data-f="open">Ù…ÙØªÙˆØ­Ø© Ø§Ù„Ø¢Ù†</button>
    <button data-f="closed">Ù…ØºÙ„Ù‚Ø© Ø§Ù„Ø¢Ù†</button>
    <button data-f="all">Ø§Ù„ÙƒÙ„</button>
  </div>
  <div id="list"></div>
</div>

<button id="lockBtn">ğŸ”’</button>

<!-- Login -->
<div class="modal hidden" id="loginModal">
  <div class="box" style="max-width:420px">
    <div class="boxHeader">
      <span>Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†</span>
      <div class="hBtns"><button onclick="closeLogin()">Ø¥ØºÙ„Ø§Ù‚</button></div>
    </div>
    <div class="boxBody">
      <input id="loginUser" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
      <input id="loginPass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
      <button class="btn primary" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
      <div id="loginErr" class="hidden" style="color:red">Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø©</div>
    </div>
  </div>
</div>

<!-- Admin -->
<div class="modal hidden" id="adminModal">
  <div class="box">
    <div class="boxHeader">
      <span>Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† â€” Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ§Øª</span>
      <div class="hBtns">
        <button onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
        <button onclick="closeAdmin()">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
    </div>

    <div class="boxBody grid">
      <!-- Left -->
      <div class="panel">
        <h3>Ø±ÙØ¹ Excel (Ø§Ø³ØªØ¨Ø¯Ø§Ù„ ÙƒØ§Ù…Ù„)</h3>
        <input type="file" id="excelFile">
        <button class="btn danger" onclick="clearAll()">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>
        <p class="meta">
          Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©:<br>
          pharmacy â€“ name â€“ address â€“ phone<br>
          open â€“ open_ampm â€“ close â€“ close_ampm
        </p>

        <h3>Ø¥Ø¶Ø§ÙØ© ØµÙŠØ¯Ù„ÙŠØ©</h3>
        <input id="f_pharmacy" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©">
        <input id="f_address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†">
        <input id="f_phone" placeholder="Ø§Ù„Ù‡Ø§ØªÙ">
        <input id="f_open" placeholder="ÙØªØ­ 10:00">
        <select id="f_open_ampm"><option>AM</option><option>PM</option></select>
        <input id="f_close" placeholder="Ø¥ØºÙ„Ø§Ù‚ 03:00">
        <select id="f_close_ampm"><option>AM</option><option>PM</option></select>
        <button class="btn primary" onclick="addPharmacy()">Ø­ÙØ¸</button>
      </div>

      <!-- Right -->
      <div class="panel">
        <h3>Ø³Ø¬Ù„ Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ§Øª</h3>
        <table id="adminTable"></table>
      </div>
    </div>
  </div>
</div>

<script>
const SUPABASE_URL="https://wvezqetliqbotmkybezj.supabase.co";
const API_KEY="sb_publishable_APdaO2PyWThd6ISkSdpR1Q_yfTNJO8y";
const TABLE="pharmacies";
const ADMIN_USER="amuda.br";
const ADMIN_PASS="@Bb300300";

let pharmacies=[],filter="open";

/* time */
const toMin=(t,a)=>{let[h,m]=t.split(":").map(Number);if(a==="PM"&&h!==12)h+=12;if(a==="AM"&&h===12)h=0;return h*60+m}
const isOpen=p=>{const n=new Date(),now=n.getHours()*60+n.getMinutes();const o=toMin(p.open,p.open_ampm),c=toMin(p.close,p.close_ampm);return c<o?(now>=o||now<c):(now>=o&&now<c)}

/* render */
function render(){
  const q=searchInput.value.toLowerCase();
  let items=pharmacies.filter(p=>p.pharmacy.toLowerCase().includes(q)).map(p=>({...p,_o:isOpen(p)}));
  if(filter==="open")items=items.filter(p=>p._o);
  if(filter==="closed")items=items.filter(p=>!p._o);
  list.innerHTML=items.length?items.map(p=>`
    <div class="card">
      <div class="card-top">
        <div>
          <b>${p.pharmacy}</b>
          <div class="meta">${p.address||""}</div>
          <div class="meta">${p.phone||""}</div>
        </div>
        <span class="badge ${p._o?"open":"closed"}">${p._o?"Ù…ÙØªÙˆØ­Ø©":"Ù…ØºÙ„Ù‚Ø©"}</span>
      </div>
    </div>`).join(""):`<div class="empty">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</div>`;
}

/* load */
async function load(){
  const r=await fetch(`${SUPABASE_URL}/rest/v1/${TABLE}?select=*`,{headers:{apikey:API_KEY,Authorization:`Bearer ${API_KEY}`}});
  pharmacies=await r.json();
  loading.style.display="none";
  render();drawAdmin();
}

/* filters */
filters.onclick=e=>{
  if(!e.target.dataset.f)return;
  filters.querySelectorAll("button").forEach(b=>b.classList.remove("active"));
  e.target.classList.add("active");
  filter=e.target.dataset.f;render();
}
searchInput.oninput=render;

/* login */
lockBtn.onclick=()=>loginModal.classList.remove("hidden");
function closeLogin(){loginModal.classList.add("hidden")}
function login(){
  if(loginUser.value===ADMIN_USER&&loginPass.value===ADMIN_PASS){
    loginModal.classList.add("hidden");
    publicWrapper.classList.add("hidden");
    adminModal.classList.remove("hidden");
  }else loginErr.classList.remove("hidden");
}
function logout(){adminModal.classList.add("hidden");publicWrapper.classList.remove("hidden")}
function closeAdmin(){adminModal.classList.add("hidden");publicWrapper.classList.remove("hidden")}

/* admin */
function drawAdmin(){
  adminTable.innerHTML=`<tr><th>Ø§Ø³Ù…</th><th>Ø­Ø°Ù</th></tr>`+
    pharmacies.map(p=>`<tr><td>${p.pharmacy}</td><td><button class="btn danger" onclick="delPh('${p.id}')">Ø­Ø°Ù</button></td></tr>`).join("");
}
async function delPh(id){
  await fetch(`${SUPABASE_URL}/rest/v1/${TABLE}?id=eq.${id}`,{method:"DELETE",headers:{apikey:API_KEY,Authorization:`Bearer ${API_KEY}`}});
  load();
}
async function addPharmacy(){
  await fetch(`${SUPABASE_URL}/rest/v1/${TABLE}`,{
    method:"POST",
    headers:{apikey:API_KEY,Authorization:`Bearer ${API_KEY}`,"Content-Type":"application/json"},
    body:JSON.stringify({
      pharmacy:f_pharmacy.value,
      address:f_address.value,
      phone:f_phone.value,
      open:f_open.value,
      open_ampm:f_open_ampm.value,
      close:f_close.value,
      close_ampm:f_close_ampm.value
    })
  });
  load();
}
async function clearAll(){
  await fetch(`${SUPABASE_URL}/rest/v1/${TABLE}`,{method:"DELETE",headers:{apikey:API_KEY,Authorization:`Bearer ${API_KEY}`}});
  load();
}

/* Excel */
excelFile.onchange=async e=>{
  const buf=await e.target.files[0].arrayBuffer();
  const wb=XLSX.read(buf,{type:"array"});
  const rows=XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);
  await clearAll();
  for(const r of rows){
    await fetch(`${SUPABASE_URL}/rest/v1/${TABLE}`,{
      method:"POST",
      headers:{apikey:API_KEY,Authorization:`Bearer ${API_KEY}`,"Content-Type":"application/json"},
      body:JSON.stringify(r)
    });
  }
  load();
}

load();
</script>
</body>
</html>
